(this["webpackJsonpvg-voting"]=this["webpackJsonpvg-voting"]||[]).push([[0],{41:function(e,t,n){e.exports=n(78)},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),s=n(35),i=n.n(s),r=(n(23),n(24),n(9)),o=n(15),c=n(16),u=n(17),m=(n(25),n(26),n(27),n(37)),h=n(10),g=n(7),f=n(21),d=n.n(f),v={apiKey:"AIzaSyCQnGWPb9g0qVM-mYsuvC-MlbWztZBdtmw",authDomain:"vg-voting-83c84.firebaseapp.com",databaseURL:"https://vg-voting-83c84.firebaseio.com",projectId:"vg-voting-83c84",storageBucket:"vg-voting-83c84.appspot.com",messagingSenderId:"14819118797",appId:"1:14819118797:web:6a3006215809c1a8ffe384"},b=function e(){Object(r.a)(this,e),d.a.apps.length?this.firebase=d.a.app():this.firebase=d.a.initializeApp(v)},p=n(36),E=n.n(p),k=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).hasUnmounted=!1,a.handleVotingCodes=function(e){var t=a.codeFile.files[0],n=a.firebase.storage().ref().child("voting_codes.xlsx");t||alert("V\xe4lj en fil med r\xf6stkoder."),n.put(t).then((function(e){n.getDownloadURL().then((function(e){a.hasUnmounted||a.setState({votingCodesFile:e})}))}))},a.handleVotes=function(e){var t=a.voteFile.files[0],n=a.firebase.storage().ref().child("votes.xlsx");t||alert("V\xe4lj en fil med r\xf6ster."),n.put(t).then((function(e){n.getDownloadURL().then((function(e){a.hasUnmounted||a.setState({votesFile:e})}))}))},a.onClick=function(e){a.handleVotingCodes(),a.handleVotes(),a.props.history.push("/voting-vg/results"),e.preventDefault()},a.setCodeRef=function(e){a.codeFile=e},a.setVoteRef=function(e){a.voteFile=e},a.firebase=(new b).firebase,a.handleVotingCodes=a.handleVotingCodes.bind(Object(g.a)(a)),a.handleVotes=a.handleVotes.bind(Object(g.a)(a)),a.onClick=a.onClick.bind(Object(g.a)(a)),a}return Object(o.a)(n,[{key:"componentWillUnmount",value:function(){var e=this;this.setCodeRef=function(t){e.codeFile=null},this.setVoteRef=function(t){e.voteFile=null}}},{key:"render",value:function(){return l.a.createElement("div",{className:"container"},l.a.createElement("div",null,l.a.createElement("div",{className:"row justify-content-center"},l.a.createElement("div",{className:"ml-5 mr-2"},l.a.createElement("h4",null,"Ladda upp fil med r\xf6stkoder"),l.a.createElement("input",{type:"file",className:"form-control-file",ref:this.setCodeRef})),l.a.createElement("br",null),l.a.createElement("div",{className:"ml-4"},l.a.createElement("h4",null,"Ladda upp fil med r\xf6ster"),l.a.createElement("input",{type:"file",className:"form-control-file",ref:this.setVoteRef})))),l.a.createElement("br",null),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.onClick},"Ladda upp"))))}}]),n}(l.a.Component),R=E()(k),y=n(40),C=n(19),V=n.n(C),N=n(63),x=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={votingResult:[],finalResults:[],resultsVisible:!1,resultButtonVisible:!0,isResultValid:null,voteLength:0,codeWorkbook:null,voteWorkbook:null,isFetched:!1},a.onClick=a.onClick.bind(Object(g.a)(a)),a.calculateResults=a.calculateResults.bind(Object(g.a)(a)),a.resultList=a.resultList.bind(Object(g.a)(a)),a.resultButton=a.resultButton.bind(Object(g.a)(a)),a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.firebase=(new b).firebase,this.initCodeFile(),this.initVoteFile()}},{key:"initVoteFile",value:function(){var e=new N.Workbook;this.firebase.storage().ref().child("votes.xlsx").getDownloadURL().then((function(t){fetch(t).then((function(t){t.blob().then((function(t){t.arrayBuffer().then((function(t){e.xlsx.load(t)}))}))}))})).catch((function(e){alert("N\xe5got gick fel, f\xf6rs\xf6k igen!"+e)})),this.setState({voteWorkbook:e},this.r\u00f6ven)}},{key:"initCodeFile",value:function(){var e=new N.Workbook;this.firebase.storage().ref().child("voting_codes.xlsx").getDownloadURL().then((function(t){fetch(t).then((function(t){t.blob().then((function(t){t.arrayBuffer().then((function(t){e.xlsx.load(t)}))}))}))})).catch((function(e){alert("N\xe5got gick fel, f\xf6rs\xf6k igen!"+e)})),this.setState({codeWorkbook:e},this.r\u00f6ven)}},{key:"getVotingCodes",value:function(){var e=[];return this.state.voteWorkbook.getWorksheet().getColumn("B").eachCell((function(t){return e.push(t.text)})),e.slice(1)}},{key:"getReferenceCodes",value:function(){var e=[];return this.state.codeWorkbook.getWorksheet().getColumn("A").eachCell((function(t){return e.push(t.text)})),e}},{key:"compareVotingCodes",value:function(){var e=this,t=[],n=this.getVotingCodes(),a=this.getReferenceCodes(),l=[],s=[];return n.forEach((function(n){a.includes(n)?(t.push(n),l.push("Giltig r\xf6st: "+n),a=a.filter((function(e){return e!==n}))):t.includes(n)?(s.push("Ogiltig r\xf6st, har r\xf6stat mer \xe4n 1 g\xe5ng: "+n),e.setState({isResultValid:!1})):(s.push("Ogiltig r\xf6st, ej registrerad: "+n),e.setState({isResultValid:!1}))})),0===s.length&&this.setState({isResultValid:!0}),[l,s]}},{key:"getElections",value:function(){var e={};return this.state.voteWorkbook.getWorksheet().getRow(1).eachCell((function(t){"Tidst\xe4mpel"!==t.text&&"Valkod"!==t.text&&(e[t.text]=[])})),e}},{key:"getVotes",value:function(){for(var e=this.state.voteWorkbook.getWorksheet(),t=this.getElections(),n=3;n<=e.actualColumnCount;n++)e.getColumn(n).eachCell((function(e){for(var n in t)if(e.text.startsWith(n)){var a=t[n];a.push(e.text),t[n]=a}}));for(var a in t)t[a].shift();return t}},{key:"countVotes",value:function(){var e=this.getVotes(),t={};for(var n in e)e[n].forEach((function(e){(e=e.split(",")).forEach((function(e){t[e.trim()]=t[e.trim()]+1||1}))}));return t}},{key:"r\xf6ven",value:function(){console.log(this.state)}},{key:"onClick",value:function(e){this.props.history.push("/voting-vg/file-selector"),e.preventDefault()}},{key:"calculateResults",value:function(){var e=this.countVotes(),t=[];this.compareVotingCodes().forEach((function(e){return e.forEach((function(e){return t.push(e)}))}));var n=Object.entries(e),a=[];n.forEach((function(e){var t=Object(y.a)(e,2),n=t[0],l=t[1];if(1===l)var s=" r\xf6st";else s=" r\xf6ster";a.push(n+": "+l+s)})),this.setState({votingResult:t,finalResults:a,resultsVisible:!0,resultButtonVisible:!1,voteLength:this.getReferenceCodes().length},this.r\u00f6ven)}},{key:"resultButton",value:function(){return l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.calculateResults},"Visa valresultat"))}},{key:"resultList",value:function(){var e=this.state.voteLength===this.state.votingResult.length;return this.state.isResultValid&&e?l.a.createElement("div",{className:"container w-75"},l.a.createElement("h1",null,l.a.createElement("b",null,"Resultat")),l.a.createElement("ul",{className:"list-group"},this.state.finalResults.map((function(e){return l.a.createElement("li",{key:V()(),className:"list-group-item"}," ",l.a.createElement("h3",null," ",e))}))),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("h1",null,l.a.createElement("b",null,"R\xf6stvalidering")),l.a.createElement("br",null),l.a.createElement("h3",null,l.a.createElement("b",null,"Antal r\xf6stande: ",this.state.votingResult.length)),l.a.createElement("h3",null,l.a.createElement("b",null,"R\xf6stl\xe4ngd: ",this.state.voteLength)),l.a.createElement("br",null),l.a.createElement("ul",{className:"list-group"},this.state.votingResult.map((function(e){return l.a.createElement("li",{key:V()(),className:"list-group-item"}," ",l.a.createElement("h3",null," ",e))}))),l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.onClick},"Genomf\xf6r en ny r\xf6stning"))):this.state.isResultValid&&!e?l.a.createElement("div",{className:"container w-75"},l.a.createElement("h5",null,l.a.createElement("b",null,"R\xf6stningen \xe4r inte giltig. R\xf6stl\xe4ngd och antalet r\xf6ster st\xe4mmer \xf6verensst\xe4mmer inte.")),l.a.createElement("br",null),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("h5",null,"Antal r\xf6stande: ",this.state.votingResult.length),l.a.createElement("h5",null,"R\xf6stl\xe4ngd: ",this.state.voteLength)),l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.onClick},"Genomf\xf6r en ny r\xf6stning"))):!this.state.isResultValid&&e?l.a.createElement("div",{className:"container w-75"},l.a.createElement("h5",null,l.a.createElement("b",null,"R\xf6stningen \xe4r inte giltig. Ta bort ogiltiga r\xf6ster ur Excel-arket och ladda upp igen: ")),l.a.createElement("br",null),l.a.createElement("ul",{className:"list-group"},this.state.votingResult.map((function(e){return l.a.createElement("li",{key:V()(),className:"list-group-item"}," ",l.a.createElement("h3",null," ",e))}))),l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.onClick},"Genomf\xf6r en ny r\xf6stning"))):this.state.isResultValid||e?void 0:l.a.createElement("div",{className:"container w-75"},l.a.createElement("h5",null,l.a.createElement("b",null,"R\xf6stningen \xe4r inte giltig. Ta bort ogiltiga r\xf6ster ur Excel-arket och ladda upp igen: ")),l.a.createElement("br",null),l.a.createElement("ul",{className:"list-group"},this.state.votingResult.map((function(e){return l.a.createElement("li",{key:V()(),className:"list-group-item"}," ",l.a.createElement("h3",null," ",e))}))),l.a.createElement("br",null),l.a.createElement("h5",null,l.a.createElement("b",null,"R\xf6stningen \xe4r inte giltig. R\xf6stl\xe4ngd och antalet r\xf6ster st\xe4mmer \xf6verensst\xe4mmer inte.")),l.a.createElement("br",null),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("h5",null,"Antal r\xf6stande: ",this.state.votingResult.length),l.a.createElement("h5",null,"R\xf6stl\xe4ngd: ",this.state.voteLength)),l.a.createElement("div",{className:"col text-center"},l.a.createElement("button",{type:"button",className:"btn btn-success m-4 btn-lg",onClick:this.onClick},"Genomf\xf6r en ny r\xf6stning")))}},{key:"render",value:function(){return l.a.createElement("div",{className:"container w-50"},this.state.resultsVisible?this.resultList():null,l.a.createElement("div",{className:"row"}),this.state.resultButtonVisible?this.resultButton():null)}}]),n}(l.a.Component),w=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"composeVoteView",value:function(){return function(e){return l.a.createElement(x,e)}}},{key:"composeFileView",value:function(){return function(e){return l.a.createElement(R,e)}}},{key:"render",value:function(){var e=this.composeVoteView(),t=this.composeFileView();return l.a.createElement(m.a,null,l.a.createElement(h.d,null,l.a.createElement(h.a,{exact:!0,from:"/voting-vg",to:"voting-vg/file-selector"}),l.a.createElement("div",null,l.a.createElement("div",{className:"jumbotron text-center",style:{paddingTop:"10px",paddingBottom:"10px"}},l.a.createElement("div",{className:"text-left"},l.a.createElement("span",null,"Fr\xe5gor/support: david.jungermann@gmail.com")),l.a.createElement("h1",{className:"display-4"},l.a.createElement("span",{role:"img","aria-label":"vote"},"\ud83d\uddf3\ufe0f")," R\xf6str\xe4knare ",l.a.createElement("span",{role:"img","aria-label":"vote"},"\ud83d\uddf3\ufe0f")),l.a.createElement("p",{className:"lead"},"V\xe4stg\xf6ta Nation")),l.a.createElement("div",{className:"container w-50"},l.a.createElement(h.b,{path:"/voting-vg/file-selector",render:t})),l.a.createElement("div",null,l.a.createElement(h.b,{path:"/voting-vg/results",render:e})))))}}]),n}(l.a.Component);n(77),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(l.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[41,1,2]]]);
//# sourceMappingURL=main.2ba2e490.chunk.js.map