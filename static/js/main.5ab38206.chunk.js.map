{"version":3,"sources":["FirebaseInstance.js","FileSelector.js","ResultsView.js","App.js","serviceWorker.js","index.js"],"names":["require","config","apiKey","process","API_KEY","authDomain","AUTH_DOMAIN","databaseURL","DATABASE_URL","projectId","PROJECT_ID","storageBucket","messagingSenderId","MESSAGING_SENDER_ID","appId","APP_ID","FirebaseInstance","firebase","apps","length","this","app","initializeApp","FileSelector","props","hasUnmounted","handleVotingCodes","event","file","codeFile","files","excelFile","storage","ref","child","alert","put","then","snapshot","getDownloadURL","url","setState","votingCodesFile","handleVotes","voteFile","votesFile","onClick","history","push","preventDefault","setCodeRef","setVoteRef","bind","className","type","React","Component","withUnmounted","Excel","ResultsView","state","votingResult","finalResults","resultsVisible","resultButtonVisible","isResultValid","voteLength","voteLengthCorrect","codeWorkbook","voteWorkbook","isFetched","voteLengthResult","calculateResults","resultList","resultButton","initCodeFile","initVoteFile","workbook","Workbook","fetch","result","blob","arrayBuffer","buffer","xlsx","load","catch","error","codes","getWorksheet","getColumn","eachCell","content","text","slice","referenceCodes","nonVoters","getVotingCodes","getReferenceCodes","filter","x","includes","forEach","code","previousVoters","invalidCodes","columnHeaders","getRow","worksheet","electionVotes","getElections","i","actualColumnCount","cell","prop","startsWith","votes","shift","getVotes","results","vote","split","trim","endsWith","replace","countVotes","compareVotingCodes","array","objArray","Object","entries","finalResult","key","value","s","compareVoteLength","map","nextId","App","params","composeVoteView","composeFileView","basename","exact","from","to","style","paddingTop","paddingBottom","role","aria-label","path","render","Boolean","window","location","hostname","match","ReactDOM","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.5ab38206.chunk.js","sourcesContent":["import firebase from \"firebase\";\r\nrequire('dotenv').config();\r\n\r\nconst config = {\r\n  apiKey: process.env.API_KEY,\r\n  authDomain: process.env.AUTH_DOMAIN,\r\n  databaseURL: process.env.DATABASE_URL,\r\n  projectId: process.env.PROJECT_ID,\r\n  storageBucket: \"vg-voting-83c84.appspot.com\",\r\n  messagingSenderId: process.env.MESSAGING_SENDER_ID,\r\n  appId: process.env.APP_ID\r\n};\r\n\r\nclass FirebaseInstance {\r\n  constructor() {\r\n    !firebase.apps.length\r\n      ? (this.firebase = firebase.initializeApp(config))\r\n      : (this.firebase = firebase.app());\r\n  }\r\n}\r\nexport default FirebaseInstance;\r\n","import \"@fortawesome/fontawesome-free/css/all.min.css\";\r\nimport \"bootstrap-css-only/css/bootstrap.min.css\";\r\nimport \"bootstrap/dist/css/bootstrap.css\";\r\nimport \"bootstrap/dist/js/bootstrap.js\";\r\nimport \"mdbreact/dist/css/mdb.css\";\r\nimport React from \"react\";\r\nimport FirebaseInstance from \"./FirebaseInstance\";\r\nimport withUnmounted from \"@ishawnwang/withunmounted\";\r\n\r\nclass FileSelector extends React.Component {\r\n  hasUnmounted = false;\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.setCodeRef = (ref) => {\r\n      this.codeFile = ref;\r\n    };\r\n\r\n    this.setVoteRef = (ref) => {\r\n      this.voteFile = ref;\r\n    };\r\n    this.firebase = new FirebaseInstance().firebase;\r\n    this.handleVotingCodes = this.handleVotingCodes.bind(this);\r\n    this.handleVotes = this.handleVotes.bind(this);\r\n    this.onClick = this.onClick.bind(this);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.setCodeRef = (ref) => {\r\n      this.codeFile = null;\r\n    };\r\n\r\n    this.setVoteRef = (ref) => {\r\n      this.voteFile = null;\r\n    };\r\n  }\r\n\r\n  handleVotingCodes = (event) => {\r\n    const file = this.codeFile.files[0];\r\n    const storageRef = this.firebase.storage().ref();\r\n    const excelFile = storageRef.child(\"voting_codes.xlsx\");\r\n\r\n    if (!file) {\r\n      alert(\"Välj en fil med röstkoder.\");\r\n    }\r\n\r\n    excelFile.put(file).then((snapshot) => {\r\n      excelFile.getDownloadURL().then((url) => {\r\n        if (!this.hasUnmounted) {\r\n          this.setState({\r\n            votingCodesFile: url,\r\n          });\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  handleVotes = (event) => {\r\n    const file = this.voteFile.files[0];\r\n    const storageRef = this.firebase.storage().ref();\r\n    const excelFile = storageRef.child(\"votes.xlsx\");\r\n\r\n    if (!file) {\r\n      alert(\"Välj en fil med röster.\");\r\n    }\r\n\r\n    excelFile.put(file).then((snapshot) => {\r\n      excelFile.getDownloadURL().then((url) => {\r\n        if (!this.hasUnmounted) {\r\n          this.setState({\r\n            votesFile: url,\r\n          });\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  onClick = (event) => {\r\n    this.handleVotingCodes();\r\n    this.handleVotes();\r\n    this.props.history.push(\"/results\");\r\n    event.preventDefault();\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container\">\r\n        <div>\r\n          <div className=\"row justify-content-center\">\r\n            <div className=\"ml-5 mr-2\">\r\n              <h4>Ladda upp fil med röstkoder</h4>\r\n              <input\r\n                type=\"file\"\r\n                className=\"form-control-file\"\r\n                ref={this.setCodeRef}\r\n              />\r\n            </div>\r\n            <br></br>\r\n            <div className=\"ml-4\">\r\n              <h4>Ladda upp fil med röster</h4>\r\n              <input\r\n                type=\"file\"\r\n                className=\"form-control-file\"\r\n                ref={this.setVoteRef}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <br></br>\r\n        <div className=\"row\">\r\n          <div className=\"col text-center\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-success m-4 btn-lg\"\r\n              onClick={this.onClick}\r\n            >\r\n              Ladda upp\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withUnmounted(FileSelector);\r\n","import \"@fortawesome/fontawesome-free/css/all.min.css\";\r\nimport \"bootstrap-css-only/css/bootstrap.min.css\";\r\nimport \"mdbreact/dist/css/mdb.css\";\r\nimport React from \"react\";\r\nimport FirebaseInstance from \"./FirebaseInstance\";\r\nimport nextId from \"react-id-generator\";\r\nconst Excel = require(\"exceljs\");\r\n\r\nclass ResultsView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      votingResult: [],\r\n      finalResults: [],\r\n      resultsVisible: false,\r\n      resultButtonVisible: true,\r\n      isResultValid: null,\r\n      voteLength: 0,\r\n      voteLengthCorrect: null,\r\n      codeWorkbook: null,\r\n      voteWorkbook: null,\r\n      isFetched: false,\r\n      voteLengthResult: null,\r\n    };\r\n\r\n    this.onClick = this.onClick.bind(this);\r\n    this.calculateResults = this.calculateResults.bind(this);\r\n    this.resultList = this.resultList.bind(this);\r\n    this.resultButton = this.resultButton.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.firebase = new FirebaseInstance().firebase;\r\n    this.initCodeFile();\r\n    this.initVoteFile();\r\n  }\r\n\r\n  initVoteFile() {\r\n    var workbook = new Excel.Workbook();\r\n    const storageRef = this.firebase.storage().ref();\r\n    storageRef\r\n      .child(\"votes.xlsx\")\r\n      .getDownloadURL()\r\n      .then(function (url) {\r\n        fetch(url).then((result) => {\r\n          result.blob().then((file) => {\r\n            file.arrayBuffer().then((buffer) => {\r\n              workbook.xlsx.load(buffer);\r\n            });\r\n          });\r\n        });\r\n      })\r\n      .catch(function (error) {\r\n        alert(\"Något gick fel, försök igen!\" + error);\r\n      });\r\n    this.setState({ voteWorkbook: workbook });\r\n  }\r\n\r\n  initCodeFile() {\r\n    var workbook = new Excel.Workbook();\r\n    const storageRef = this.firebase.storage().ref();\r\n    storageRef\r\n      .child(\"voting_codes.xlsx\")\r\n      .getDownloadURL()\r\n      .then(function (url) {\r\n        fetch(url).then((result) => {\r\n          result.blob().then((file) => {\r\n            file.arrayBuffer().then((buffer) => {\r\n              workbook.xlsx.load(buffer);\r\n            });\r\n          });\r\n        });\r\n      })\r\n      .catch(function (error) {\r\n        alert(\"Något gick fel, försök igen!\" + error);\r\n      });\r\n    this.setState({ codeWorkbook: workbook });\r\n  }\r\n\r\n  getVotingCodes() {\r\n    let codes = [];\r\n    const workbook = this.state.voteWorkbook;\r\n    workbook\r\n      .getWorksheet()\r\n      .getColumn(\"B\")\r\n      .eachCell((content) => codes.push(content.text));\r\n    return codes.slice(1);\r\n  }\r\n\r\n  getReferenceCodes() {\r\n    let referenceCodes = [];\r\n    const workbook = this.state.codeWorkbook;\r\n    workbook\r\n      .getWorksheet()\r\n      .getColumn(\"A\")\r\n      .eachCell((content) => referenceCodes.push(content.text));\r\n    return referenceCodes;\r\n  }\r\n\r\n  compareVoteLength() {\r\n    var nonVoters = [];\r\n    let codes = this.getVotingCodes();\r\n    let referenceCodes = this.getReferenceCodes();\r\n    if (referenceCodes.length > codes.length) {\r\n      this.setState({ isResultValid: false, voteLengthCorrect: false });\r\n      let difference = referenceCodes.filter((x) => !codes.includes(x));\r\n      difference.forEach((code) => {\r\n        nonVoters.push(\"Registrerad, men har ej röstat: \" + code);\r\n      });\r\n    } else if (referenceCodes.length < codes.length) {\r\n      this.setState({ voteLengthCorrect: false });\r\n    } else {\r\n      this.setState({ voteLengthCorrect: true });\r\n    }\r\n    return nonVoters;\r\n  }\r\n\r\n  compareVotingCodes() {\r\n    let previousVoters = [];\r\n    let codes = this.getVotingCodes();\r\n    let referenceCodes = this.getReferenceCodes();\r\n    var result = [];\r\n    var invalidCodes = [];\r\n\r\n    codes.forEach((code) => {\r\n      if (referenceCodes.includes(code)) {\r\n        previousVoters.push(code);\r\n        result.push(\"Giltig röst: \" + code);\r\n        referenceCodes = referenceCodes.filter((x) => x !== code);\r\n      } else if (previousVoters.includes(code)) {\r\n        invalidCodes.push(\"Ogiltig röst, har röstat mer än 1 gång: \" + code);\r\n        this.setState({ isResultValid: false });\r\n      } else {\r\n        invalidCodes.push(\"Ogiltig röst, ej registrerad: \" + code);\r\n        this.setState({ isResultValid: false });\r\n      }\r\n    });\r\n    if (invalidCodes.length === 0) {\r\n      this.setState({ isResultValid: true });\r\n    }\r\n    return [result, invalidCodes];\r\n  }\r\n\r\n  getElections() {\r\n    var columnHeaders = {};\r\n    const workbook = this.state.voteWorkbook;\r\n    workbook\r\n      .getWorksheet()\r\n      .getRow(1)\r\n      .eachCell((content) => {\r\n        if (content.text !== \"Tidstämpel\" && content.text !== \"Valkod\") {\r\n          columnHeaders[content.text] = [];\r\n        }\r\n      });\r\n    return columnHeaders;\r\n  }\r\n\r\n  getVotes() {\r\n    const workbook = this.state.voteWorkbook;\r\n    let worksheet = workbook.getWorksheet();\r\n    let electionVotes = this.getElections();\r\n    for (let i = 3; i <= worksheet.actualColumnCount; i++) {\r\n      worksheet.getColumn(i).eachCell((cell) => {\r\n        for (let prop in electionVotes) {\r\n          if (cell.text.startsWith(prop)) {\r\n            let votes = electionVotes[prop];\r\n            votes.push(cell.text);\r\n            electionVotes[prop] = votes;\r\n          }\r\n        }\r\n      });\r\n    }\r\n    for (let prop in electionVotes) {\r\n      electionVotes[prop].shift();\r\n    }\r\n    return electionVotes;\r\n  }\r\n\r\n  countVotes() {\r\n    const votes = this.getVotes();\r\n    const results = {};\r\n    for (let prop in votes) {\r\n      votes[prop].forEach((vote) => {\r\n        vote = vote.split(\",\");\r\n        vote.forEach((vote) => {\r\n          vote = vote.trim();\r\n          if (vote.endsWith(\"*\")) {\r\n            vote = vote.replace(/\\*/g, \"\");\r\n          }\r\n          results[vote] = results[vote] + 1 || 1;\r\n        });\r\n      });\r\n    }\r\n    return results;\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------------------------------------------------------- //\r\n\r\n  onClick(event) {\r\n    this.props.history.push(\"/file-selector\");\r\n    event.preventDefault();\r\n  }\r\n\r\n  calculateResults() {\r\n    var result = this.countVotes();\r\n    var votingResult = [];\r\n    this.compareVotingCodes().forEach((array) =>\r\n      array.forEach((vote) => votingResult.push(vote))\r\n    );\r\n    var objArray = Object.entries(result);\r\n    var finalResult = [];\r\n\r\n    objArray.forEach(([key, value]) => {\r\n      if (value === 1) {\r\n        var s = \" röst\";\r\n      } else {\r\n        s = \" röster\";\r\n      }\r\n      finalResult.push(key + \": \" + value + s);\r\n    });\r\n    this.setState({\r\n      votingResult: votingResult,\r\n      finalResults: finalResult,\r\n      resultsVisible: true,\r\n      resultButtonVisible: false,\r\n      voteLength: this.getReferenceCodes().length,\r\n      voteLengthResult: this.compareVoteLength(),\r\n    });\r\n  }\r\n\r\n  resultButton() {\r\n    return (\r\n      <div className=\"col text-center\">\r\n        <button\r\n          type=\"button\"\r\n          className=\"btn btn-success m-4 btn-lg\"\r\n          onClick={this.calculateResults}\r\n        >\r\n          Visa valresultat\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  resultList() {\r\n    if (this.state.isResultValid && this.state.voteLengthCorrect) {\r\n      return (\r\n        <div className=\"container w-75\">\r\n          <h1>\r\n            <b>Resultat</b>\r\n          </h1>\r\n          <ul className=\"list-group\">\r\n            {this.state.finalResults.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <br></br>\r\n          <br></br>\r\n          <br></br>\r\n          <h1>\r\n            <b>Röstvalidering</b>\r\n          </h1>\r\n          <br></br>\r\n          <h3>\r\n            <b>Antal röstande: {this.state.votingResult.length}</b>\r\n          </h3>\r\n          <h3>\r\n            <b>Röstlängd: {this.state.voteLength}</b>\r\n          </h3>\r\n          <br></br>\r\n          <ul className=\"list-group\">\r\n            {this.state.votingResult.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n\r\n          <div className=\"col text-center\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-success m-4 btn-lg\"\r\n              onClick={this.onClick}\r\n            >\r\n              Genomför en ny röstning\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    } else if (this.state.isResultValid && !this.state.voteLengthCorrect) {\r\n      return (\r\n        <div className=\"container w-75\">\r\n          <h5>\r\n            <b>\r\n              Röstningen är inte giltig. Röstlängd och antalet röster stämmer\r\n              överensstämmer inte.\r\n            </b>\r\n          </h5>\r\n          <br></br>\r\n          <ul className=\"list-group\">\r\n            {this.state.voteLengthResult.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <li className=\"list-group-item\">\r\n            <h5>Antal röstande: {this.state.votingResult.length}</h5>\r\n            <h5>Röstlängd: {this.state.voteLength}</h5>\r\n          </li>\r\n          <div className=\"col text-center\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-success m-4 btn-lg\"\r\n              onClick={this.onClick}\r\n            >\r\n              Genomför en ny röstning\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    } else if (!this.state.isResultValid && this.state.voteLengthCorrect) {\r\n      return (\r\n        <div className=\"container w-75\">\r\n          <h5>\r\n            <b>\r\n              Röstningen är inte giltig. Ta bort ogiltiga röster ur Excel-arket\r\n              och ladda upp igen:{\" \"}\r\n            </b>\r\n          </h5>\r\n          <br></br>\r\n          <ul className=\"list-group\">\r\n            {this.state.votingResult.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <div className=\"col text-center\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-success m-4 btn-lg\"\r\n              onClick={this.onClick}\r\n            >\r\n              Genomför en ny röstning\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    } else if (!this.state.isResultValid && !this.state.voteLengthCorrect) {\r\n      return (\r\n        <div className=\"container w-75\">\r\n          <h5>\r\n            <b>\r\n              Röstningen är inte giltig. Ta bort ogiltiga röster ur Excel-arket\r\n              och ladda upp igen:{\" \"}\r\n            </b>\r\n          </h5>\r\n          <br></br>\r\n          <ul className=\"list-group\">\r\n            {this.state.votingResult.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <br></br>\r\n          <ul className=\"list-group\">\r\n            {this.state.voteLengthResult.map((result) => (\r\n              <li key={nextId()} className=\"list-group-item\">\r\n                {\" \"}\r\n                {<h3> {result}</h3>}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n          <br></br>\r\n          <h5>\r\n            <b>\r\n              Röstningen är inte giltig. Röstlängd och antalet röster stämmer\r\n              överensstämmer inte.\r\n            </b>\r\n          </h5>\r\n          <br></br>\r\n          <li className=\"list-group-item\">\r\n            <h5>Antal röstande: {this.state.votingResult.length}</h5>\r\n            <h5>Röstlängd: {this.state.voteLength}</h5>\r\n          </li>\r\n          <div className=\"col text-center\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-success m-4 btn-lg\"\r\n              onClick={this.onClick}\r\n            >\r\n              Genomför en ny röstning\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container w-50\">\r\n        {this.state.resultsVisible ? this.resultList() : null}\r\n        <div className=\"row\"></div>\r\n        {this.state.resultButtonVisible ? this.resultButton() : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ResultsView;\r\n","import React from \"react\";\r\nimport \"@fortawesome/fontawesome-free/css/all.min.css\";\r\nimport \"bootstrap-css-only/css/bootstrap.min.css\";\r\nimport \"bootstrap/dist/css/bootstrap.css\";\r\nimport \"bootstrap/dist/js/bootstrap.js\";\r\nimport \"mdbreact/dist/css/mdb.css\";\r\nimport {\r\n  BrowserRouter as Router,\r\n  Route,\r\n  Switch,\r\n  Redirect,\r\n} from \"react-router-dom\";\r\nimport FileSelector from \"./FileSelector\";\r\nimport ResultsView from \"./ResultsView\";\r\n\r\nclass App extends React.Component {\r\n  composeVoteView() {\r\n    return (params) => <ResultsView {...params} />;\r\n  }\r\n  composeFileView() {\r\n    return (params) => <FileSelector {...params} />;\r\n  }\r\n\r\n  render() {\r\n    const votes = this.composeVoteView();\r\n    const files = this.composeFileView();\r\n\r\n    return (\r\n      <Router basename={process.env.PUBLIC_URL}>\r\n        <Switch>\r\n          <Redirect exact from=\"/\" to=\"/file-selector\" />\r\n          <div>\r\n            <div\r\n              className=\"jumbotron text-center\"\r\n              style={{ paddingTop: \"10px\", paddingBottom: \"10px\" }}\r\n            >\r\n              <div className=\"text-left\">\r\n                <span>Frågor/support: david.jungermann@gmail.com</span>\r\n              </div>\r\n              <h1 className=\"display-4\">\r\n                <span role=\"img\" aria-label=\"vote\">\r\n                  🗳️\r\n                </span>{\" \"}\r\n                Rösträknare{\" \"}\r\n                <span role=\"img\" aria-label=\"vote\">\r\n                  🗳️\r\n                </span>\r\n              </h1>\r\n              <p className=\"lead\">Västgöta Nation</p>\r\n            </div>\r\n            <div className=\"container w-50\">\r\n              <Route path=\"/file-selector\" render={files}></Route>\r\n            </div>\r\n            <div>\r\n              <Route path=\"/results\" render={votes}></Route>\r\n            </div>\r\n          </div>\r\n        </Switch>\r\n      </Router>\r\n    );\r\n  }\r\n}\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === \"localhost\" ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === \"[::1]\" ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener(\"load\", () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            \"This web app is being served cache-first by a service \" +\r\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === \"installed\") {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                \"New content is available and will be used when all \" +\r\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log(\"Content is cached for offline use.\");\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error(\"Error during service worker registration:\", error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { \"Service-Worker\": \"script\" },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get(\"content-type\");\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        \"No internet connection found. App is running in offline mode.\"\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker.ready.then((registration) => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"bootstrap/dist/css/bootstrap.css\";\r\nimport \"bootstrap/dist/js/bootstrap.js\";\r\nimport App from \"./App\";\r\nimport \"./styles.css\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}